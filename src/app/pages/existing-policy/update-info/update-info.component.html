<div>
  @if (submitted) {
    @if (success) {
      <div>
        <div>
          <success-page></success-page>
        </div>
      </div>
    }

    @if (error) {
      <div class="error-wrapper">
        <div class="d-flex">
          <div class="col-100 me-2">
            <h3>Error</h3>
            <br />
            <p>There was an error submitting your request.</p>
            <br />
            <button (click)="retry()" mat-stroked-button color="button-1" class="button" type="button">Retry</button>
          </div>
        </div>
      </div>
    }
  }

  @if (!submitted) {
    <div class="form">
      <div class="form-section">
        <div class="section-wrapper">
          <div class="section-title">
            <h5>Coverage Details</h5>
          </div>
          <div class="body-medium-regular">
            Completed forms can be submitted directly to carrier or returned to you.
          </div>
        </div>
        <div class="form-table">
          <form class="form-fields" [formGroup]="updateInfoForm">
            <div class="form-field">
              <span class="body-medium-bold">Name of Insured</span>
              <mat-form-field appearance="outline">
                <input matInput type="text" placeholder="Enter Name of Insured" formControlName="name" />
              </mat-form-field>
            </div>
            <div class="form-field">
              <div class="body-medium-bold" style="display: flex">
                Certificate ID &nbsp;
                <mat-icon [matTooltip]="toolTip.CertificateID" matTooltipPosition="above">help</mat-icon>
              </div>
              <mat-form-field appearance="outline">
                <input matInput type="text" placeholder="Enter Certificate ID" formControlName="certificateNumber" />
              </mat-form-field>
            </div>
          </form>
        </div>
      </div>
      <div class="form-section">
        <div class="section-wrapper">
          <div class="section-title">
            <h5>Change Request</h5>
          </div>
          <div class="body-medium-regular">Select the change request(s) applicable to the insurance coverage.</div>
        </div>

        <div class="form-table">
          <form [formGroup]="updateInfoForm">
            <div class="form-wrapper">
              <div>
                <small class="body-medium-regular">
                  Please note that additional supporting documentation may be requested by the carrier in order to
                  proceed with the requested account updates below.
                </small>
                <!-- <mat-divider class="mt-3 mb-5"></mat-divider> -->

                <div class="d-flex">
                  <!-- warning -->

                  <div class="col-100 me-2">
                    @if (!bankingDetailsDisabled || bankingDetailsChecked) {
                      <mat-divider class="mt-3 mb-4"></mat-divider>
                      <div class="bankingDetails section">
                        <mat-checkbox
                          [disabled]="bankingDetailsDisabled"
                          [checked]="bankingDetailsChecked"
                          (click)="bankingDetailsClicked()"
                          >Change Banking Details</mat-checkbox
                        >
                      </div>
                    }

                    @if (showBankingDetails) {
                      <div>
                        <p class="body-medium-regular">
                          Provide the new direct debit information for payment of insurance premiums
                        </p>
                        <div class="mt-4 d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">Institution Number</span>
                            <mat-form-field appearance="outline">
                              <input
                                matInput
                                type="number"
                                placeholder="Enter Institution Number"
                                formControlName="institutionNo" />
                            </mat-form-field>
                          </div>

                          <div class="col-100">
                            <span class="body-medium-bold">Transit Number</span>
                            <mat-form-field appearance="outline">
                              <input
                                matInput
                                type="number"
                                placeholder="Enter Transit Number"
                                formControlName="transitNo" />
                            </mat-form-field>
                          </div>
                        </div>

                        <div class="d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">Account Number</span>
                            <mat-form-field appearance="outline">
                              <input
                                matInput
                                type="number"
                                placeholder="Enter Account Number"
                                formControlName="accountNo" />
                            </mat-form-field>
                          </div>
                        </div>
                      </div>
                    }

                    @if (!memberInfoDisabled || memberInfoChecked) {
                      <mat-divider class="mt-3 mb-4"></mat-divider>
                      <div class="section">
                        <mat-checkbox
                          [disabled]="memberInfoDisabled"
                          [checked]="memberInfoChecked"
                          (click)="memberInfoClicked()"
                          >Update Contact Information</mat-checkbox
                        >
                      </div>
                    }

                    @if (showMemberDetails) {
                      <div>
                        <p class="body-medium-regular">Provide the updated contact information.</p>
                        <div class="mt-4 d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">First Name</span>
                            <mat-form-field appearance="outline">
                              <input matInput type="text" placeholder="Enter First Name" formControlName="firstName" />
                            </mat-form-field>
                          </div>

                          <div class="col-100">
                            <span class="body-medium-bold">Last Name</span>
                            <mat-form-field appearance="outline">
                              <input matInput type="text" placeholder="Enter Last Name" formControlName="lastName" />
                            </mat-form-field>
                          </div>
                        </div>

                        <div class="d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">Phone Number</span>
                            <mat-form-field appearance="outline">
                              <input
                                matInput
                                mask="(000) 000-0000"
                                type="text"
                                placeholder="Enter Phone Number"
                                formControlName="phoneNumber" />
                            </mat-form-field>
                          </div>

                          <div class="col-100">
                            <span class="body-medium-bold">Phone Type</span>
                            <mat-form-field appearance="outline">
                              <mat-select
                                placeholder="Select Phone Type"
                                formControlName="phoneType"
                                panelClass="panel-dropdown">
                                <mat-option>Select Phone Type</mat-option>
                                <mat-option value="Mobile">Mobile</mat-option>
                                <mat-option value="Home">Home</mat-option>
                                <mat-option value="Work">Work</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </div>
                        </div>

                        <div class="d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">Email</span>
                            <mat-form-field appearance="outline">
                              <input matInput type="text" placeholder="Enter Email Address" formControlName="email" />
                            </mat-form-field>
                          </div>
                        </div>

                        <div class="d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">Address</span>
                            <mat-form-field appearance="outline">
                              <input
                                matInput
                                type="text"
                                placeholder="Enter Street Address"
                                formControlName="address" />
                            </mat-form-field>
                          </div>
                        </div>

                        <div class="d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">Unit Number (Optional)</span>
                            <mat-form-field appearance="outline">
                              <input matInput type="text" placeholder="Enter Unit Number" formControlName="unitNo" />
                            </mat-form-field>
                          </div>

                          <div class="col-100">
                            <span class="body-medium-bold">City</span>
                            <mat-form-field appearance="outline">
                              <input matInput type="text" placeholder="Enter City" formControlName="city" />
                            </mat-form-field>
                          </div>
                        </div>

                        <div class="d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">Province</span>
                            <mat-form-field appearance="outline">
                              <mat-select
                                placeholder="Select Province"
                                formControlName="province"
                                panelClass="panel-dropdown">
                                <mat-option>Select Province</mat-option>
                                <mat-option value="AB">AB</mat-option>
                                <mat-option value="BC">BC</mat-option>
                                <mat-option value="MB">MB</mat-option>
                                <mat-option value="NB">NB</mat-option>
                                <mat-option value="NL">NL</mat-option>
                                <mat-option value="NS">NS</mat-option>
                                <mat-option value="NT">NT</mat-option>
                                <mat-option value="NU">NU</mat-option>
                                <mat-option value="ON">ON</mat-option>
                                <mat-option value="PE">PE</mat-option>
                                <mat-option value="QC">QC</mat-option>
                                <mat-option value="SK">SK</mat-option>
                                <mat-option value="YT">YT</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </div>

                          <div class="col-100">
                            <span class="body-medium-bold">Postal Code</span>
                            <mat-form-field appearance="outline">
                              <input
                                matInput
                                allCaps
                                type="text"                              
                                placeholder="Enter Postal Code"
                                formControlName="postalCode" />
                            </mat-form-field>
                          </div>
                        </div>
                      </div>
                    }

                    @if (!newLoanIdDisabled || newLoanIdChecked) {
                      <mat-divider class="mt-3 mb-4"></mat-divider>
                      <div class="section">
                        <mat-checkbox
                          [disabled]="newLoanIdDisabled"
                          [checked]="newLoanIdChecked"
                          (click)="newLoanIdClicked()"
                          >Update Loan ID</mat-checkbox
                        >
                      </div>
                    }

                    @if (showLoanIdDetails) {
                      <div>
                        <p class="body-medium-regular">
                          Provide the new Loan ID associated with the existing coverage.
                        </p>
                        <div class="mt-4 d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold"
                              >New Loan ID &nbsp;
                              <mat-icon [matTooltip]="toolTip.NewLoanId" matTooltipPosition="above">help</mat-icon>
                            </span>
                            <mat-form-field appearance="outline">
                              <input
                                matInput
                                type="text"
                                placeholder="Enter New Loan ID"
                                formControlName="newCertificateNo" />
                            </mat-form-field>
                          </div>
                        </div>
                      </div>
                    }

                    @if (!reinstatementReasonDisabled || reinstatementReasonChecked) {
                      <mat-divider class="mt-3 mb-4"></mat-divider>
                      <div class="section">
                        <mat-checkbox
                          [disabled]="reinstatementReasonDisabled"
                          [checked]="reinstatementReasonChecked"
                          (change)="reinstatementReasonClicked($event.checked)"
                          >Coverage Reinstatement</mat-checkbox
                        >
                      </div>
                    }

                    @if (showReinstatementReason) {
                      <div>
                        <p class="body-medium-regular">
                          Provide the reason for reinstatement of the insurance coverage(s) under this account.
                        </p>
                        <div class="mt-4 d-flex">
                          <div class="col-100 me-2">
                            <span class="body-medium-bold">Reason for Reinstatement</span>

                            <mat-form-field appearance="outline">
                              <mat-select
                                placeholder="Select Reason for Reinstatement"
                                formControlName="reinstatementReason"
                                panelClass="panel-dropdown">
                                <mat-option>Select Reinstatement Reason</mat-option>
                                <mat-option value="Cancelled in Error">Cancelled in Error</mat-option>
                                <mat-option value="Cancelled Due to Payment in Arrears"
                                  >Cancelled Due to Payment in Arrears</mat-option
                                >
                                <mat-option value="Other">Other</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </div>
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="form-buttons">
        <button
          class="button-primary"
          (click)="onSubmit()"
          [disabled]="
            !(
              updateInfoForm.valid &&
              (bankingDetailsEntered() || memberInfoEntered() || newLoanIdEntered() || reinstatementReasonEntered())
            )
          ">
          Update Information
        </button>
      </div>
    </div>
  }
</div>
