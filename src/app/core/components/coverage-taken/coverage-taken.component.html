@let appIndex = applicationIndex();
@let applicationsList = applications();

@for (coverage of applicationsList[appIndex].coverages; track coverage.coverageType; let i = $index) {
  <div>
    @if (i === 0) {
      <div
        [ngClass]="{
          'justify-content-between': insuranceType() !== 'SP' || applicantLength() >= 3,
          'justify-content-start gap-6': applicantLength() <= 2 && insuranceType() === 'SP',
        }"
        class="d-flex w-100 border-bottom-grey pb-3">
        <div class="mw-230Pixels body-medium-bold securian-pine-text-color">Coverages</div>
        @for (applicant of applicationsList[appIndex].applicants; track applicant.applicantIdentifier) {
          <div
            [ngClass]="{
              'mw-216Pixels': applicantLength() === 4 && insuranceType() === 'SP',
              'mw-230Pixels': insuranceType() !== 'SP' || applicantLength() < 4,
            }"
            class="body-medium-bold securian-pine-text-color">
            {{ applicant.firstName }} {{ applicant.lastName }}
          </div>
        }

        @if (insuranceType() !== 'SP') {
          <div class="mw-142Pixels body-medium-bold securian-pine-text-color text-end">Premium</div>
          <div class="mw-142Pixels body-medium-bold securian-pine-text-color text-end">Insured Amount</div>
        }
      </div>
    }

    <div
      [ngClass]="{
        'justify-content-between': insuranceType() !== 'SP' || applicantLength() >= 3,
        'justify-content-start gap-6': applicantLength() <= 2 && insuranceType() === 'SP',
      }"
      class="d-flex pt-1 align-items-center border-bottom-grey">
      <div class="d-flex mw-230Pixels body-medium-bold">
        <span>
          {{ getCoverageDescription(coverage.coverageType) }}
        </span>
        @if (coverage.returnCode !== 0) {
          <span class="ms-1">
            <div
              class="warning-color"
              appTooltip
              [tooltip]="{ tooltip: coverage.returnMessage, position: 'top', style: 'warning' }"
              aria-label="details">
              <mat-icon class="warning-color">error_outline</mat-icon>
            </div>
          </span>
        }
      </div>
      @for (applicant of applicationsList[appIndex].applicants; track applicant.applicantIdentifier) {
        <div
          [ngClass]="{
            'mw-216Pixels': applicantLength() === 4 && insuranceType() === 'SP',
            'mw-230Pixels': insuranceType() !== 'SP' || applicantLength() < 4,
          }">
          <div
            class="flex-item-content"
            [ngClass]="{
              'mw-300Pixels': quoteType() === 'SP' && applicantLength() === 1,
              'mw-230Pixels': quoteType() !== 'SP',
            }">
            @let coverageType = coverage.coverageType;
            <div [formGroup]="coverageForm">
              <div class="personalized" [matTooltip]="matSelect.triggerValue" matTooltipPosition="right">
                <mat-form-field appearance="outline" class="w-100 min-padding-bottom">
                  <mat-select
                    #matSelect
                    panelClass="panel-dropdown"
                    (selectionChange)="selectionChangeInsurance($event)"
                    formControlName="dropDown{{ coverageType }}-{{ applicant?.applicantSequence }}">
                    @for (option of waiverReasonsByCoverageType(coverageType); track option.waiverReasonCode) {
                      <mat-option [value]="option.waiverReasonCode" [disabled]="!option.isSelectable">
                        {{ option.waiverReasonDescription }}
                      </mat-option>
                    } @empty {
                      <mat-option disabled> Waiver reason not loaded </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </div>
        </div>
      }
      @if (insuranceType() !== 'SP') {
        <div class="mw-142Pixels body-medium-regular text-end">
          ${{ addPremiumPlusTax(coverage?.premiumAmount, coverage?.premiumTaxAmount) | number: '1.2' }}
        </div>
        <div class="mw-142Pixels body-medium-regular text-end">${{ coverage?.insuredAmount | number: '1.2' }}</div>
      }
    </div>
  </div>
}

@if (insuranceType() !== 'SP') {
  <mat-divider class="pt-2"></mat-divider>
}

@let displayHorizontal = !displayHorizontally();
<div
  class="right-details-content"
  [ngClass]="{
    'bg-secondary bg-opacity-10 right-details-content-vertical mt-3': displayHorizontal,
  }">
  @if (displayHorizontal) {
    <div class="d-flex gap-5">
      <div class="d-flex flex-column justify-content-between pb-2 gap-3">
        <div class="flex-item body-medium-bold securian-pine-text-color mh-20Pixels pb-3">
          {{ displayHorizontal ? '' : 'Coverages' }}
        </div>
        @if (applicationsList.length > 0) {
          @for (coverage of applicationsList[appIndex].coverages; track coverage.coverageType) {
            @if (!displayHorizontal) {
              @if (coverage.returnCode !== 0) {
                <div class="d-flex align-items-center body-medium-bold">
                  <span>{{ getCoverageDescription(coverage.coverageType) }}</span>
                  <span class="ms-1">
                    <div
                      class="warning-color"
                      appTooltip
                      [tooltip]="{ tooltip: coverage.returnMessage, position: 'top', style: 'warning' }"
                      aria-label="details">
                      <mat-icon class="warning-color">error_outline</mat-icon>
                    </div>
                  </span>
                </div>
              }

              @if (coverage.returnCode === 0) {
                <div class="d-flex align-items-center body-medium-bold">
                  <span>{{ getCoverageDescription(coverage.coverageType) }}</span>
                </div>
              }
            }

            @if (displayHorizontal) {
              <div class="flex-item body-medium-bold" [ngClass]="{ 'securian-pine-text-color': displayHorizontal }">
                {{ getCoverageDescription(coverage.coverageType) }}
              </div>
            }
          }
        }
      </div>

      @if (quoteInsuranceTypeResponseData$ | async; as quoteResp) {
        <div
          class="d-flex flex-column justify-content-between pb-3"
          [ngClass]="{ 'ps-11Percent ps-5': displayHorizontal }">
          <div class="flex-item body-medium-bold securian-pine-text-color pb-3 text-end">Premium</div>
          @for (coverage of applicationsList[appIndex].coverages; track coverage.coverageType) {
            <div class="flex-item body-medium-regular pb-6 text-end">
              ${{ addPremiumPlusTax(coverage?.premiumAmount, coverage?.premiumTaxAmount) | number: '1.2' }}
            </div>
          }
        </div>
      }

      <div
        class="d-flex flex-column justify-content-between pb-3"
        [ngClass]="{ 'ps-3 ps-7Percent': displayHorizontal }">
        <div class="flex-item body-medium-bold securian-pine-text-color pb-3 text-end">Insured Amount</div>
        @for (coverage of applicationsList[appIndex].coverages; track coverage.coverageType) {
          <div class="flex-item body-medium-regular pb-6 text-end">${{ coverage?.insuredAmount | number: '1.2' }}</div>
        }
      </div>
    </div>
  }

  @if (insuranceType() === 'SP') {
    <mat-divider></mat-divider>
  }

  <div>
    @if (insuranceType() === 'SP') {
      <div class="d-flex flex-row gap-5 pt-3">
        <div class="fel-column mw-200Pixels">
          <div class="body-medium-bold pb-3">Premium Total:</div>
          <div class="body-medium-bold">Amortization:</div>
        </div>
        <div class="fel-column ps-11Percent">
          <div class="body-medium-bold pb-3">${{ getTotalPremiumPayment() | number: '1.2' }}</div>
          <div class="body-medium-bold text-start">{{ applicationsList[appIndex].amortization }} Months</div>
        </div>
      </div>
    } @else {
      <div class="d-flex justify-content-between pt-1 pb-3 align-items-center">
        <div class="mw-230Pixels"></div>
        @if (applicantLength() === 2) {
          <div class="mw-230Pixels"></div>
        }
        <div class="mw-142Pixels"></div>
        <div class="mw-142Pixels body-medium-bold text-end">
          Monthly Premium Total: ${{ getTotalPremiumPayment() | number: '1.2' }}
        </div>
        <div class="mw-142Pixels"></div>
      </div>
    }
  </div>
  @for (singleApplication of applicationsList; track singleApplication.id;
  let singleApplicationIndex = $index) {
  <div>
    @if (canBeTakenPartially() && singleApplicationIndex == appIndex) {
      <div class="left-details-content bg-secondary bg-opacity-10">
        <h5>Partial Coverage</h5>
        <div class="body-medium-regular pt-2">
          Select partial coverage by inputting a percentage or amount (optional).
        </div>

        @let applicationId = singleApplication.id;
        <div class="d-flex pt-4">
          <div class="me-4 w-30">
            <span class="body-medium-bold">Insured Loan %</span>
            <div [formGroup]="coverageForm" class="w-100">
              <mat-form-field appearance="outline" class="w-100">
                <input
                  matInput
                  type="text"
                  onlyDecimal
                  [maxValue]="100"
                  placeholder="Enter Insured Loan %"
                  name="lifeLoanPercentage-{{ applicationId }}"
                  (blur)="reQuoteValues($event)"
                  formControlName="lifeLoanPercentage-{{ applicationId }}"
                  min="0" />
                <span matSuffix class="ffix-space">%</span>
              </mat-form-field>
            </div>
          </div>
          <div class="w-30">
            <span class="body-medium-bold">Insured Loan Amount</span>
            <div [formGroup]="coverageForm">
              <mat-form-field appearance="outline" class="w-100">
                <input
                  matInput
                  currencyMask
                  [options]="{ prefix: '' }"
                  type="text"
                  placeholder="Enter Insured Loan Amount"
                  name="lifeLoanAmount-{{ applicationId }}"
                  (blur)="reQuoteValues($event)"
                  formControlName="lifeLoanAmount-{{ applicationId }}" />
                <span matPrefix>$ </span>
                <span matSuffix>&nbsp; </span>
              </mat-form-field>
            </div>
          </div>
        </div>

        <div class="d-flex pt-2">
          <div class="me-4 w-30">
            <span class="body-medium-bold">Insured Payment %</span>
            <div [formGroup]="coverageForm">
              <mat-form-field appearance="outline" class="w-100">
                <input
                  matInput
                  onlyDecimal
                  [maxValue]="100"
                  type="text"
                  placeholder="Enter Insured Payment %"
                  name="insuredPaymentPercentage-{{ applicationId }}"
                  (blur)="reQuoteValues($event)"
                  formControlName="insuredPaymentPercentage-{{ applicationId }}"
                  min="0" />
                <span matSuffix class="ffix-space">%</span>
              </mat-form-field>
            </div>
          </div>
          <div class="w-30">
            <span class="body-medium-bold">Insured Payment Amount</span>
            <div [formGroup]="coverageForm">
              <mat-form-field appearance="outline" class="w-100">
                <input
                  matInput
                  currencyMask
                  [options]="{ prefix: '' }"
                  type="text"
                  name="insuredPaymentAmount-{{ applicationId }}"
                  placeholder="Enter Insured Payment Amount"
                  (blur)="reQuoteValues($event)"
                  formControlName="insuredPaymentAmount-{{ applicationId }}" />
                <span matPrefix>$ </span>
                <span matSuffix>&nbsp; </span>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
}
</div>